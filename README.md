# MJPEG-VideoPlayer
Test task for Macroscop. Decoding MJPEG stream and render it with using of WPF

# Требования

Разработать приложение на .NET Framework (версия 4.5 или выше), позволяющее просматривать видео реального времени с одной из камер, подключенных к серверу видеонаблюдения. Сервер находится по адресу http://demo.macroscop.com:8080/ и имеет открытый HTTP API,  позволяющий сторонним системам получать список доступных камер и видео с них.
Сервер может выполнять следующие запросы:
1. Запрос конфигурации
Пример: http://demo.macroscop.com:8080/configex?login=root
В ответ отправляется XML-документ, содержащий, в частности, все доступные камеры (элементы ChannelInfo), их имена (поля Name) и идентификаторы (поля Id).
2. Запрос видео
Пример: http://demo.macroscop.com:8080/mobile?login=root&channelid=2016897c-8be5-4a80-b1a3-7f79a9ec729c&resolutionX=640&resolutionY=480&fps=25
В ответ на запрос сервер будет возвращать видео с камеры в формате MJPEG, имеющей идентификатор, заданный в параметре channelid.  Просмотреть видео из примера возможно с помощью программы VLC Player (http://www.videolan.org/).
Необходимо отправить HTTP-запрос из примера 2), в полученном потоке научиться выделять кадры и отображать их в вашем приложении. 
Большим плюсом будет возможность выбора в программе камеры для просмотра.

Требование к приложению одно - не использовать готовые библиотеки и алгоритмы.

# Что я сделал 10 марта

1. Отправил HTTP-запрос на сервер, получил XML-документ. Из него достал айдишники камер.
2. Один из айди подставил в запрос видео из условия, вставил в браузер, начался скачиваться поток видео. Чтобы как-то его зафиксировать, включил запись в программе *HttpAnalyzerStdV7* и сохранил 11-секундный отрывок в виде файла.
3. Открыл в hex-редакторе. Понял, что jpeg всегда начинается с байтов FF D8 и заканчивается FF D9. Написал цикл, который каждое вхождение JPEG-рисунка в MJPEG-видео заливает в отдельный массив (на самом деле лист) байт. Сохранил все файлы в отдельной папке, пронумеровав.
4. Было сложно рендерить любой рисунок в окне. Оказалось, случайный тестовый пример, который я взял из гугла, был сломанный, и я долго провозился, хотя всё делал правильно. Ну сейчас вроде нормально.
Вот еще есть [ссылка](https://stackoverflow.com/questions/589173/rendering-an-image-at-runtime-in-wpf "Rendering an image at runtime in WPF") . Может, что-то пригодится завтра.
6. Понял, что нужно использовать потоки. Как? Не знаю.
7. Из 11-секундного куска потокового видео получается почти 300 кадров. Сохранил их в отдельной папке, потому что пока не научился работать с потоками, нет смысла держать их в байтах. 
![Набор фреймов](https://pp.userapi.com/c834200/v834200182/e4332/6GvKOtDFiw0.jpg "Набор фреймов") 

# Что нужно сделать 11 марта
1. Добить программу, чтобы подходила по всем требованиям.
2. Разобраться с MMVM. Сложно.

